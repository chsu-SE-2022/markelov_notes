**Цель работы:** реализовать публикацию приложений, разработанных в лабораторных работах № 2 и 3, в Docker.
## Теория
#### Docker
**Docker** - это платформа для контейнеризации приложений. Она позволяет разработчикам упаковывать приложения и их зависимости в легковесные контейнеры, которые могут работать одинаково на любой системе, будь то локальный компьютер, сервер или облачная платформа.  
**Контейнер** **Docker** - автономная виртуальная система, содержащая выполняющийся процесс, все файлы, зависимости, адресное пространство процесса и сетевые порты, необходимые приложению.  
**Основные преимущества Docker**:
- Повышает совместимость: контейнеры гарантируют одинаковую работу приложения на любой системе
- Ускоряет разработку: меньше проблем с настройкой окружения
- Легковесен: в отличие от виртуальных машин, контейнеры используют ядро хоста и занимают меньше ресурсов
#### Docker Image
**Docker Image (образ Docker)** - это неизменяемый шаблон, содержащий всё необходимое для запуска контейнера. Это своего рода "снимок" системы, включающий в себя:
- Код приложения
- Зависимости (библиотеки, конфигурационные файлы, утилиты)
- Среду выполнения (например, .NET, Python)
  
Основные характеристики:
- Образы состоят из слоев (layers). Каждый слой представляет изменения в файлах или настройках
- Docker Image используется как основа для создания контейнеров
- Docker Image не работает само по себе - для запуска его нужно превратить в контейнер
#### Dockerfile
**Dockerfile** - это текстовый файл с инструкциями для сборки Docker Image. Он описывает шаги, которые Docker должен выполнить, чтобы создать образ.  
Основные команды в `Dockerfile`:
1. `FROM` - указывает базовый образ, от которого создаётся новый образ
2. `WORKDIR` - задаёт рабочую директорию внутри контейнера
3. `COPY` - копирует файлы из локальной машины в контейнер
4. `RUN` - выполняет команды в процессе сборки
5. `CMD` - задаёт команду, которая запускается при старте контейнера
6. Команда `EXPOSE` в Docker используется в файле `Dockerfile` для объявления портов, которые приложение внутри контейнера будет использовать для связи или на которых оно ожидает входящие соединения. Однако `EXPOSE` не выполняет реальной публикации портов наружу. Оно служит скорее для документирования и создания метаданных, указывая, какие порты следует использовать для связи с контейнером
  
Пример простого `Dockerfile` для ASP.NET Core приложения:
```
FROM mcr.microsoft.com/dotnet/aspnet:7.0
WORKDIR /app
COPY . .
RUN dotnet restore
RUN dotnet publish -c Release -o /publish
CMD ["dotnet", "/publish/MyApp.dll"]
```
#### Docker Compose
**Docker Compose** - это инструмент для запуска и управления несколькими Docker-контейнерами как одним приложением. С его помощью вы можете определять настройки всех контейнеров, их взаимодействия, сети, объемы и другие параметры в одном конфигурационном файле (`docker-compose.yml`).
#### Сборка контейнера в Visual Studio
Visual Studio имеет встроенные средства для работы с Docker, которые упрощают процесс разработки, тестирования и деплоя приложений в контейнерах.
Как собрать контейнер в Visual Studio:
1. Добавление Docker в проект:
	- В контекстном меню проекта выберите `Add > Docker Support`
	- Visual Studio автоматически добавит файл `Dockerfile` и настроит проект для работы с Docker
2. Сборка образа Docker:
	- Запуск построения образа доступен при выборе опции `Build Docker Image` в контекстном меню `Dockerfile`
	- Вы можете увидеть созданный образ в Docker Desktop или через команду `docker images`
3. Запуск контейнера:
	- Нажмите F5 или Ctrl+F5 для запуска проекта. Visual Studio создаст и запустит контейнер
	- Visual Studio также откроет браузер, чтобы вы могли сразу протестировать приложение
	- Или можно создать контейнер из образа и запустить его через Docker Desktop
  
Примечание: Visual Studio автоматически добавляет файлы для поддержки Docker Compose, если в проекте используется несколько контейнеров.
#### Docker Desktop
**Docker Desktop** — это официальное приложение от Docker для Windows, которое предоставляет удобный интерфейс (GUI) и инструменты для работы с контейнерами на компьютере под управлением Windows. Это универсальная платформа, включающая всё необходимое для разработки, сборки, тестирования и запуска контейнеров Docker.  
Ключевые особенности Docker Desktop для Windows:
1. Интеграция с Windows и WSL2:
	- Docker Desktop работает на основе WSL2 (Windows Subsystem for Linux), обеспечивая производительность, близкую к нативной
	- Позволяет запускать Linux-контейнеры на Windows без использования виртуальных машин
	- Поддержка Windows-контейнеров (для приложений, работающих в Windows Server Core)
2. Графический интерфейс (GUI):
	- Удобный интерфейс для управления контейнерами, образами, томами и сетями
	- Возможность отслеживать состояние контейнеров, просматривать логи и выполнять действия (старт, стоп, удаление)
3. Инструменты для разработчиков:
	- Интеграция с Visual Studio и Visual Studio Code
	- Поддержка Docker CLI (командной строки) прямо в терминале
	- Возможность работать с docker-compose
4. Docker Hub:
	- Встроенная поддержка Docker Hub для поиска и загрузки готовых образов
5. Поддержка Kubernetes:
	- Docker Desktop предоставляет встроенную возможность развертывания и управления кластерами Kubernetes прямо из интерфейса
6. Кроссплатформенность:
	- Docker Desktop одинаково работает на Windows и macOS, предоставляя разработчикам единый опыт
#### Переадресация портов в Docker
**Переадресация портов (порт-маппинг)** в Docker позволяет подключать порты контейнера к портам хостовой машины. Это необходимо, чтобы приложение, работающее в контейнере, было доступно извне.  
Как работает порт-маппинг:
- Когда вы запускаете контейнер, вы можете указать, как порты контейнера будут отображаться на хосте
- Пример команды для запуска контейнера с маппингом портов:
	```
	docker run -p 8080:80 myimage
	```
	Первый порт (8080) - порт хоста, второй порт (80) - порт контейнера
  
Настройка в Docker Compose:
- В файле docker-compose.yml порт-маппинг задаётся в секции ports. Пример:
	```
	services:
		webapi:
			build: .
			ports:
				- "8080:80"
	```
Проверка маппинга портов:
1. Убедитесь, что контейнер работает:
2. Проверьте доступность приложения, открыв в браузере: http://localhost:8080.
#### Источники информации
1. П.С. Кочер. Микросервисы и контейнеры Docker
## Задание
1. Продумать адресацию сетевого взаимодействия между приложениями, и при необходимости внести изменения в проекты
2. Добавить в проект Web API (лабораторная работа № 2) поддержку Docker и отредактировать (при необходимости) Dockerfile
3. Добавить в проект Web Blazor App (лабораторная работа № 3) поддержку Docker и отредактировать (при необходимости) Dockerfile
4. Собрать образ (Docker image) и опубликовать в DockerDesktop
5. Выполнить запуск контейнеров настроив переадресацию портов
6. Протестировать функциональность приложения с учетом сетевого взаимодействия между приложениями