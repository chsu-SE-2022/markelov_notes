<html>
<head>
   <title>Коррелированные вложенные подзапросы</title>

</head>

<body background="fon.jpg">
<div align="center"><b><font>3.3.5. Коррелированные вложенные подзапросы</font></b></div><font size = "-1">

<p align=justify>Выдать название и статус поставщиков продукта с номером 11.</P>

<PRE>
SELECT	Название, Статус
FROM	Поставщики
WHERE	11 IN
	(	SELECT	ПР
		FROM	Поставки
		WHERE	ПС = Поставщики.ПС );</PRE>

<p align=justify>Такой подзапрос отличается от рассмотренного в п.<a href=3-3-2.htm>3.3.2</a> тем, что вложенный подзапрос не может быть обработан прежде, чем будет обрабатываться внешний подзапрос. Это связано с тем, что вложенный подзапрос зависит от значения Поставщики.ПС а оно изменяется по мере того, как система проверяет различные строки таблицы Поставщики. Следовательно, с концептуальной точки зрения обработка осуществляется следующим образом:</P>
<OL>	<LI> Система проверяет первую строку таблицы Поставщики. Предположим, что это строка поставщика с номером 1. Тогда значение Поставщики.ПС будет в данный момент имеет значение, равное 1, и система обрабатывает внутренний запрос

<PRE>
(	SELECT	ПР
	FROM	Поставки
	WHERE	ПС = 1 );</PRE>

получая в результате множество (9, 11, 12, 15). Теперь система может завершить обработку для поставщика с номером 1. Выборка значений Название и Статус для ПС=1 (СЫТНЫЙ и рынок) будет проведена тогда и только тогда, когда ПР=11 будет принадлежать этому множеству, что, очевидно, справедливо.
<LI> Далее система будет повторять обработку такого рода для следующего поставщика и т.д. до тех пор, пока не будут рассмотрены все строки таблицы Поставщики.</OL>
<p align=justify>Подобные подзапросы называются коррелированными, так как их результат зависит от значений, определенных во внешнем подзапросе. Обработка коррелированного подзапроса, следовательно, должна повторяться для каждого значения извлекаемого из внешнего подзапроса, а не выполняться раз и навсегда.</P>
Рассмотрим пример использования одной и той же таблицы во внешнем подзапросе и коррелированном вложенном подзапросе.
<p align=justify>Выдать номера всех продуктов, поставляемых только одним по-ставщиком.</P>
<TABLE width=100%>
<TR><TH></TH><TH align=left>Результат:</TH></TR>
<TR valign=top><TD><PRE>
SELECT	DISTINCT X.ПР
FROM	Поставки X
WHERE	X.ПР NOT IN
	(	SELECT	Y.ПР	
		FROM	Поставки Y	
		WHERE	Y.ПС <> X.ПС ); </PRE></TD>
		
<TD>
<TABLE>
<TR><th>X.ПР</TH></TR>
<TR><TD>17</TD></TR>
</TABLE>
</TD>
</TR>
</TABLE>

<p align=justify>Действие этого запроса можно пояснить следующим образом: "Поочередно для каждой строки таблицы Поставки, скажем X, выделить значение номера продукта (ПР), если и только если это значение не входит в некоторую строку, скажем, Y, той же таблицы, а значение столбца номер поставщика (ПС) в строке Y не равно его значению в строке X".</P>
<p align=justify>Отметим, что в этой формулировке должен быть использован по крайней мере один псевдоним - либо X, либо Y.</P>


<p align="center">
<a href="3-3-4.htm">3.3.4</a> | <a href="index.htm">Содержание</a> | <a href="3-3-6.htm">3.3.6</a>
</p>

</body>
</html>
