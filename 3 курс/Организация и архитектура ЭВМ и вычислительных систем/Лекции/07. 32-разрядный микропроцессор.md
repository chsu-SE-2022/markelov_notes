## Структура 32-разрядного микропроцессора
![Структура 32-разрядного процессора](../Pictures/07_01.%20Структура%2032-разрядного%20процессора.png)  
- **Процессор чисел с фиксированной точкой**: содержит 32-разрядное АЛУ и 32-разрядный блок регистров общего назначения
	- **АЛУ** предназначено для обработки двоичных чисел длиной в 1, 2 или 4 байта без знака или со знаком, а также двоично-десятичных чисел, не превышающих 99. Двоичные числа со знаком представляются в дополнительном коде
	- **Блок из 8 регистров общего назначения**, часть из которых допускает 16- и 8-разрядное обращение
- **Процессор чисел с плавающей точкой FPU**: состоит из 80-разрядного АЛУ и 80-разрядного блока регистров общего назначения. Используется для обработки чисел с плавающей точкой, целых чисел со знаком длиной 8 байт и двоично-десятичных чисел, начиная со 100
- **Блок управления памятью** состоит из 2 основных блоков:
	- **Блок сегментации** (блок сегментного преобразования адреса)
	- **Блок страничного преобразования адреса**, в состав которого входит блок ассоциативной трансляции страничного адреса TLB
- **Кэш-память**: находится между регистрами процессора и основной памятью. Используется для хранения наиболее часто используемой информации
- **Блок управления**: в состав блока управления входят:
	- **Устройство управления**, которое под действием кода команды вырабатывает набор управляющих сигналов, поступающих на разные узлы процессора и на блок интерфейса внешней шины
	- **Управление защитой** - обеспечивает аппаратную защиту программ и данных по привилегиям
	- **Управление предвыборкой** - реализует опережающее заполнение буфера команд. Буфер команд имеет емкость 32 байта и заполняется командами из следующих ячеек памяти команд по мере своего освобождения. Этим обеспечивается ускорение обработки микропроцессора следующей командой
- **Блок интерфейса внешней шины** - осуществляет электрическое согласование параметров внутренней магистрали с сигналами внешней магистрали, формирование необходимых сигналов на внешнюю магистраль и прием сигналов извне. 
- **Внешняя магистраль** - состоит из 3 шин: 
	- **Шина данных** - 32 разряда
	- **Шина адреса** - передается 32-разрядный адрес по 34-разрядной шине адреса. $A31...A2 + (B3, B2, B1, B0)$. Чтобы с минимальными потерями согласовать 32-разрядную шину данных с передачей данных меньшей разрядности, младшие разряды адреса $A0$ и $A1$ передаются в дешифрованном виде. Они показывают, какие байты из 32-разрядной шины данных в данный момент востребованы: 1-ый байт, 2 младших байта, 2 старших байта или все 32
	- **Шина управления** - 32 разряда. Передает сигналы записи и чтения содержимого ОП из внешних устройств, сигналы запросов прерываний и сигналы прямого доступа к памяти
## Типы чисел 32-разрядного процессора
| Тип                      | Размер, байт                      | Диапазон                        | Обработка |
| ------------------------ | --------------------------------- | ------------------------------- | --------- |
| Целые без знака          | 1                                 | 0...255                         | АЛУ ФТ    |
|                          | 2                                 | 0...65535                       | АЛУ ФТ    |
|                          | 4                                 | 0...$4.3∗10^9$                  | АЛУ ФТ    |
| Целые со знаком          | 1                                 | -128...+127                     | АЛУ ФТ    |
|                          | 2                                 | -32768...+32767                 | АЛУ ФТ    |
|                          | 4                                 | $-2.1∗10^9$...$-2.1∗10^9$       | АЛУ ФТ    |
|                          | 8                                 | $-9.1∗10^{18}$...$-9.1∗10^{18}$ | FPU       |
| С плавающей точкой       | 4 (1+8+23), знак-порядок-мантисса | $\pm3.37∗10^{35}$               | FPU       |
|                          | 8 (1+11+52)                       | $\pm1.67∗10^{308}$              | FPU       |
|                          | 10 (1+15+64)                      | $\pm1.1∗10^{4932}$              | FPU       |
| Двоично-десятичные числа | 1 распакованный                   | 0...9                           | АЛУ ФТ    |
|                          | 1 упакованный                     | 0...9                           | АЛУ ФТ    |
|                          | 10 упакованных                    | 0...9...9 (18 цифр)             | FPU       |
## Регистровая архитектура
В 32-разрядном процессоре выделяют следующие группы регистров:
1. **Основные функциональные регистры** - используются прикладными программами. В их состав входят: 
	- **Регистры общего назначения**:  
		![Регистры общего назначения](../Pictures/07_02.%20Регистры%20общего%20назначения.png)
	- **Регистр указателя команд и регистр флагов**. Регистр указателя команд `EIP` хранит смещение адреса команд относительно начала сегмента кода. Регистр флагов `EFLAGS` содержит признаки результата, а также разряды, управляющие работой микропроцессора:
		- Флаги состояния:
			- `ZF` - признак нуля и результата
			- `OF` - флаг переполнения
			- `CF` - флаг переноса
			- `DF` - флаг направления обработки строк
			- `SF` - флаг знака
			- `PF` - флаг четности
			- `AF` - флаг для работы с двоично-десятичными числами
		- `IF` - флаг прерываний
		- `TF` - флаг трассировки
		- `NT` - вид вложенной задачи - показывает, что данная задача была вызвана из другой задачи, и возврат должен производится по механизму переключения задач
		- `IOPL` - 2-разрядное поле уровня привилегий ввода-вывода
		- `VM` - режим виртуального процессора 8086 (при `VM = 1`). Может быть установлен только в защищенном режиме
		  
		![Регистр указателя команд и регистр флагов](../Pictures/07_03.%20Регистр%20указателя%20команд%20и%20регистр%20флагов.png)
	- **Сегментные регистры**: `CS`, `DS`, `SS`, `ES`, `FS`, `GS` (все по 16 разрядов). При работе микропроцессора в реальном режиме в сегментном регистре содержатся старшие 16 разрядов 20-разрядного базового адреса сегмента. Физический адрес начала сегмента получаются умножением этой величины на 16: $`A_{баз.сегм}=(сегм.регистр)*16`$ Получающийся 20 разрядный адрес позволяет адресовать память с ёмкостью 1 Мб. При переходе к 32-разрядной системе стало необходимо обеспечить адресацию памяти. Введение защищенного режима потребовало хранение дополнительной информации о сегменте: его длине, которая стала переменной, уровне привилегий и т. д. Поэтому все данные о сегменте хранятся в специальных структурах - дескрипторах сегментов, которые хранятся в таблицах дескрипторов. А сегментные регистры, которые сохранили свою длину в 16 разрядов, содержат селектор (указатель), который используется для нахождения нужного дескриптора в таблице
2. **Регистры процессора с плавающей точкой** - используются прикладными программами:
	- **Регистры данных** - могут использоваться как стек или как набор пронумерованных регистров. Старший бит 80-разрядного регистра данных кодирует знак мантиссы. Следующие биты отведены под кодирование порядка. Последнее поле отведено под мантиссу числа. Количество разрядов, отводимых под поля порядка и мантиссы, определяется регистром управления `FPU`.  
		![Регистры данных](../Pictures/07_04.%20Регистры%20данных.png)
	- **Регистры тэгов** - определяют содержимое регистра данных с целью оптимизации и обработки:
		- `00` - достоверное значение в регистре данных
		- `01` - нулевое значение в регистре данных
		- `10` - в регистре данных записано не число
		- `11` - в регистре данных пусто
		  
		Использование тегов позволяет в некоторых случаях сократить время выполнения операции.  
		![Регистры тегов](../Pictures/07_05.%20Регистры%20тэгов.png)
3. Системные регистры - используются системными программами, имеющими наивысший уровень привилегий
4. Регистры отладки и тестирования - используются системными программами, имеющими наивысший уровень привилегий
  
