<html>
<head>
   <title>Использование INSERT...SELECT для построения внешнего соединения</title>

</head>
<body background="fon.jpg">
<div align="center"><b><font>4.3.3. Использование INSERT...SELECT для построения внешнего соединения</font></b></div><font size = "-1">

<p align=justify>Рассмотренное в п.<a href=3-2-3.htm>3.2.3</a> естественное соединение двух таблиц не включает тех строк какой-либо из них, для которых нет соответствующих строк в другой таблице. Например, если в таблицу Блюда были занесены под номером 34 сведения о Шашлыке, а рецепт его приготовления не был занесен в таблицу Рецепты, то при загрузке их естественного соединения в таблицу Временная:</p>
<pre>
CREATE TABLE Временная
	(	Вид	CHAR (8),
		Блюдо	CHAR (60),
		Рецепт	CHAR (560));

INSERT
INTO	Временная
SELECT	Вид, Блюдо, Рецепт
FROM	Блюда, Рецепты, Вид_блюд
WHERE	Блюда.БЛ = Рецепты.БЛ
AND	Блюда.В = Вид_блюд.В;
</pre>
<p align=justify>в ней не окажется строки с Шашлыком (в таблице Рецепты не обнаружен код 34, и строка с этим кодом исключена из результата).</p>
<p align=justify>Следовательно, в некотором смысле можно считать, что при обычном соединении теряется информация для таких несоответствующих строк. Однако иногда (как и в приведенном примере) может потребоваться способность сохранить эту информацию. В этом случае можно воспользоваться так называемым внешним соединением:</p>
<pre>
INSERT
INTO	Временная
SELECT	Вид, Блюдо, Рецепт
FROM	Блюда, Рецепты, Вид_блюд
WHERE	Блюда.БЛ = Рецепты.БЛ
AND	Блюда.В = Вид_блюд.В;

INSERT
INTO	Временная
SELECT	Вид, Блюдо, “???”
FROM	Блюда, Вид_блюд
WHERE	Блюда.В = Вид_блюд.В
AND	БЛ NOT IN
	(	SELECT	БЛ
		FROM	Рецепты);
</pre>
<p align=justify>В результате будет создана базовая таблица</p>

<TABLE>
<TR><TH>Вид  </TH><TH>Блюдо</TH><TH>Рецепт</TH></TR>
<TR><TD>Закуска</TD><TD>Салат летний</TD><TD>Помидоры и яблоки нарезать...</TD></TR>
<TR><TD>Закуска	 </TD><TD>Салат мясной  </TD><TD>  Вареное охлажденное мясо, ...</TD></TR>
<TR><TH colspan=3> .  .  .</TH></TR>
<TR><TD>Напиток </TD><TD>Кофе черный    </TD><TD> Кофеварку или кастрюлю спо...</TD></TR>
<TR><TD>Напиток </TD><TD>Кофе на молоке </TD><TD> Сварить черный кофе, как  ...</TD></TR>
<TR><TD>Горячее  </TD><TD>Шашлык</TD><TD>???</TD></TR>
</TABLE>

<p align=justify>где первые 33 строки соответствуют первому INSERT и представляют собой проекцию естественного соединения таблиц Блюда и Рецепты по кодам блюд (БЛ), включающую три столбца. Последняя строка результата соответствует второму INSERT и сохраняет информацию о блюде Шашлык, рецепт котого пока не введен в таблицу Рецепты.</p>
<p align=justify>Заметим, что для внешнего соединения нужны два отдельных INSERT...SELECT. Однако тот же результат можно получить и одним INSERT...SELECT, используя фразу UNION, объединяющую предложения SELECT из двух INSERT:</p>
<pre>
INSERT
INTO	Временная
SELECT	Вид, Блюдо, Рецепт
FROM	Блюда, Рецепты, Вид_блюд
WHERE	Блюда.БЛ = Рецепты.БЛ
AND	Блюда.В = Вид_блюд.В
UNION
SELECT	Вид, Блюдо, “???”
FROM	Блюда, Вид_блюд
WHERE	Блюда.В = Вид_блюд.В
AND	БЛ NOT IN
	(	SELECT	БЛ
		FROM	Рецепты);	
</pre>

<p align="center">
<a href="4-3-2.htm">4.3.2</a> | <a href="index.htm">Содержание</a> | <a href="4-4.htm">4.4</a>
</p>

</body>
</html>
