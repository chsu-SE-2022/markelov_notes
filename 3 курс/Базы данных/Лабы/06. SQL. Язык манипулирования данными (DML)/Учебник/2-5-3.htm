<html>
<head>
   <title>Фраза GROUP BY</title>

</head>

<body background="fon.jpg">
<div align="center"><b><font>2.5.3. Фраза GROUP BY</font></b></div><font size = "-1">

<p align=justify>Мы показали, как можно вычислить массу определенного продукта, поставляемого поставщиками. Предположим, что теперь требуется вычислить общую массу каждого из продуктов, поставляемых в настоящее время поставщиками. Это можно легко сделать с помощью предложения</P>
<PRE>
SELECT	ПР, SUM(К_во)
FROM	Поставки
GROUP	BY ПР;
</PRE>

<P>Результат показан на рис. 2.3,а.</P>
<CENTER><TABLE border=1 width=80%>
<TR><TD> а)</TD><TD> б)</TD><TD> в)</TD><TD> г)</TD></TR>
<TR valign=top><TD>
<TABLE>	
<TR><th>ПР</th></TR>
<TR><TD>9</TD><TD>0</TD></TR>	  
<TR><TD>11</TD><TD>150</TD></TR>	 
<TR><TD>12</TD><TD>30</TD></TR>	  
<TR><TD>15</TD><TD>370</TD></TR>	 
<TR><TD>1</TD><TD>370</TD></TR>	  
<TR><TD>3</TD><TD>250</TD></TR>	 
<TR><TD>5</TD><TD>170</TD></TR>	  
<TR><TD>6</TD><TD>220</TD></TR>	  
<TR><TD>8</TD><TD>150</TD></TR>	  
<TR><TD>7</TD><TD>200</TD></TR>	
<TR><TD>2</TD><TD>0</TD></TR>	 
<TR><TD>4</TD><TD>100</TD></TR>	 
<TR><TD>13</TD><TD>190</TD></TR>	
<TR><TD>14</TD><TD>70</TD></TR>	
<TR><TD>16</TD><TD>250</TD></TR>	  
<TR><TD>17</TD><TD>50</TD></TR>	 
<TR><TD>10</TD><TD>220</TD></TR>
</TABLE></TD>
<TD><TABLE>
<TR><th>ПС</TH><th>ПР</th><TH>Цена</th><TH>К_во</TH></TR>	
<TR><TD>1</TD><TD>9</TD><TD>-0-</TD><TD>-0-</TD></TR>	
<TR><TD>3</TD><TD>9</TD><TD>-0-</TD><TD>-0-</TD></TR>	
<TR><TD>5</TD><TD>9</TD><TD>-0-</TD><TD>-0-</TD></TR>	
<TR><TD>1</TD><TD>11</TD><TD>1.50</TD><TD>50</TD></TR>	
<TR><TD>5</TD><TD>11</TD><TD>-0-</TD><TD>-0-</TD></TR>	
<TR><TD>6</TD><TD>11</TD><TD>-0-</TD><TD>-0-</TD></TR>	
<TR><TD>8</TD><TD>11</TD><TD>1.00</TD><TD>100</TD></TR>	
<TR><TD>1</TD><TD>12</TD><TD>3.00</TD><TD>10</TD></TR>	
<TR><TD>3</TD><TD>12</TD><TD>2.50</TD><TD>20</TD></TR>	
<TR><TD>6</TD><TD>12</TD><TD>-0-</TD><TD>-0-</TD></TR>	
<TR><TD>1</TD><TD>15</TD><TD>2.00</TD><TD>170</TD></TR>	
<TR><TD>3</TD><TD>15</TD><TD>1.50</TD><TD>200</TD></TR>	
<TR><TD>2</TD><TD>1</TD><TD>3.60</TD><TD>300</TD></TR>	
<TR><TD>7</TD><TD>1</TD><TD>4.20</TD><TD>70</TD></TR>	
<TR><TD>2</TD><TD>3</TD><TD>-0-</TD><TD>-0-</TD></TR>	
<TR><TD>7</TD><TD>3</TD><TD>4.00</TD><TD>250</TD></TR>	
<TR><TH colspan=4>		.  .  .</TH></TR>		
</TABLE></TD>

<TD><TABLE><TR><TH>ПР</TH></TR>
<TR><TD>1</TD><TD>370</TD></TR>	
<TR><TD>2</TD><TD>0</TD></TR>	 
<TR><TD>3</TD><TD>250</TD></TR>	
<TR><TD>4</TD><TD>100</TD></TR>	 
<TR><TD>5</TD><TD>170</TD></TR>	
<TR><TD>6</TD><TD>220</TD></TR>	
<TR><TD>7</TD><TD>200</TD></TR>	
<TR><TD>8</TD><TD>150</TD></TR>	
<TR><TD>9</TD><TD>0</TD></TR>
<TR><TD>10</TD><TD>220</TD></TR>	  
<TR><TD>11</TD><TD>150</TD></TR> 
<TR><TD>12</TD><TD>30</TD></TR>	
<TR><TD>13</TD><TD>190</TD></TR>	  
<TR><TD>14</TD><TD>70</TD></TR>	 
<TR><TD>15</TD><TD>370</TD></TR>	
<TR><TD>16</TD><TD>250</TD></TR>	 
<TR><TD>17</TD><TD>50</TD></TR>
</TABLE></TD>

<TD><TABLE><TR><th>ПР</th></TR>
<TR><TD>9</TD><TD>0</TD></TR>
<TR><TD>11</TD><TD>150</TD></TR>
<TR><TD>12</TD><TD>30</TD></TR>
<TR><TD>15</TD><TD>70</TD></TR>
<TR><TD>1</TD><TD>370</TD></TR>
<TR><TD>3</TD><TD>250 </TD></TR>
<TR><TD>5</TD><TD>70</TD></TR>
<TR><TD>6</TD><TD>140</TD></TR>
<TR><TD>8</TD><TD>150</TD></TR>
<TR><TD>7</TD><TD>200</TD></TR>
<TR><TD>2</TD><TD>0</TD></TR>
<TR><TD>4</TD><TD>100 </TD></TR>
<TR><TD>13</TD><TD>190</TD></TR>
<TR><TD>14</TD><TD>70 </TD></TR>
<TR><TD>16</TD><TD>250</TD></TR>
<TR><TD>17</TD><TD>50</TD></TR>
<TR><TD>10</TD><TD>220</TD></TR>
</TABLE></TD>
</TR>
</TABLE></CENTER>

<p align=center><I>	Рис. 2.3. Иллюстрации к фразе GROUP BY</I></P>

<p align=justify>Фраза GROUP BY (группировать по) инициирует перекомпоновку указанной во FROM таблицы по группам, каждая из которых имеет одинаковые значения в столбце, указанном в GROUP BY. В рассматриваемом примере строки таблицы Поставки группируются так, что в одной группе содержатся все строки для продукта с ПР = 1, в другой – для продукта с ПР = 2 и т.д. (см. рис. 2.3.б). Далее к каждой группе применяется фраза SELECT. Каждое выражение в этой фразе должно принимать единственное значение для группы, т.е. оно может быть либо значением столбца, указанного в GROUP BY, либо арифметическим выражением, включающим это значение, либо константой, либо одной из SQL-функций, которая оперирует всеми значениями столбца в группе и сводит эти значения к единственному значению (например, к сумме).</P>
<p align=justify>Отметим, что фраза GROUP BY не предполагает ORDER BY. Чтобы гарантировать упорядочение по ПР результата рассматриваемого примера (рис. 2.3,в) следует дать запрос</P>

<PRE>
SELECT	ПР, SUM(К_во)
FROM	Поставки
GROUP	BY ПР
ORDER	BY ПР;</PRE>

<p align=justify>Наконец, отметим, что строки таблицы можно группировать по любой комбинации ее столбцов. Так, по запросу</P>

<PRE>
SELECT	Т, БЛ, COUNT(БЛ)
FROM	Заказ
GROUP	BY Т, БЛ;</PRE>

<p align=justify>можно узнать коды и количество порций блюд, заказанных отдыхающими пансионата (32 человека) на каждую из трапез следующего дня:</P>

<TABLE>
<TR><th>Т</TH><th>БЛ</TH><th>COUNT(БЛ)</TH></TR>
<TR><td align=center>	1</TD><td align=center>3</TD><td align=center>18</TD></TR>
<TR><td align=center>	1</TD><td align=center>	6</TD><td align=center>	14</TD></TR>
<TR><td align=center>	1</TD><td align=center>	19</TD><td align=center>	17</TD></TR>
<TR><td align=center>	1</TD><td align=center>21</TD><td align=center>	15</TD></TR>
<TR><TH colspan=3>		...</TH></TR>
</TABLE>

<p align=justify>Если в запросе используются фразы WHERE и GROUP BY, то строки, не удовлетворяющие фразе WHERE, исключаются до выполнения группирования.</P>
<p align=justify>Например, выдать для каждого продукта его код и общий объем возможных поставок, учитывая временную недееспособность поставщика с ПС=2:</P>
<PRE>
SELECT	ПР, SUM(К_во)
FROM	Поставки
WHERE	ПС <> 2
GROUP	BY ПР;</PRE>

<p align=justify>Результат, приведенный на рис. 2.3,г, отличается от результата (рис. 2.3,а) аналогичного запроса для всех поставщиков объемом поставок продуктов с кодами 15, 5 и 6.</P>


<p align="center">
<a href="2-5-2.htm">2.5.2</a> | <a href="index.htm">Содержание</a> | <a href="2-5-4.htm">2.5.4</a>
</p>

</body>
</html>
